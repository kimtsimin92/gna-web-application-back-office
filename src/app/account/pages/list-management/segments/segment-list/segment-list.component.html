<div class="gna-bc">
  <span>Marketing / Segments</span>
</div>

<div class="container-fluid">

  <div>
    <mat-card class="gna-card">

      <mat-card-header class="gna-card-header">
        <div class="container-fluid">
          <div class="gna-list-header">
            <div class="gna-list-header-1">
              <span class="p-input-icon-left">
                <i class="pi pi-search"></i>
                <input pInputText type="text" (keyup)="filterResults(filter.value)" placeholder="Recherche..."
                  class="example-full-width gna-list-ir" #filter [disabled]="isSave" />

              </span>
            </div>
            <div class="gna-list-header-2">
              <button mat-raised-button color="primary" class="gna-btn-default" (click)="onGoToSave()">Créer
                Segment</button>
            </div>
          </div>
        </div>
      </mat-card-header>

      <div class="container-fluid">

        <p-table #dt [value]="filteredList" dataKey="id" styleClass="p-datatable-striped"
          [tableStyle]="{ 'min-width': '75rem' }" [loading]="loading" [rows]="rows" [totalRecords]="totalRecords"
          [paginator]="false" [first]="first" (onPage)="pageChange($event)"
          [rowsPerPageOptions]="[5, 10, 20, 15, 30, 50, 100]"
          [globalFilterFields]="['matricule_cmu', 'nom', 'prenom', 'genre']" [scrollable]="true"
          [resizableColumns]="true">
          <ng-template pTemplate="header">
            <tr class="gna-table-header">
              <th pSortableColumn="code">
                Code
                <p-sortIcon field="code" />
                <!--                  <p-columnFilter type="text" field="matricule_cmu" display="menu" />-->
              </th>
              <th pSortableColumn="name">
                Nom du segment
                <!--                  <p-columnFilter type="text" field="genre" display="menu" />-->
                <p-sortIcon field="name" />
              </th>

              <th pSortableColumn="createdAt" class="gna-responsive">Enregistrement
                <!--                  <p-columnFilter type="date" field="createdAt" display="menu" />-->
                <p-sortIcon field="createdAt" />

              </th>
              <th></th>
              <th></th>
            </tr>
          </ng-template>

          <ng-template pTemplate="body" let-element let-expanded="expanded">
            <tr>
              <td>
                <div class="row">

                  <div class="col-8 gna-table-td-mt">
                    @if (element.code ) {
                    {{ element.code }}
                    } @else {
                    N/A
                    }
                  </div>
                </div>
              </td>
              <td>
                @if (element.name) {
                {{element.name }}
                }@else {
                N/A
                }
              </td>

              <td class="gna-responsive">
                @if (element.createdAt) {
                {{ element.createdAt | date: 'dd-MM-YYYY'}} {{ element.createdAt | date: 'hh:mm:ss'}}
                } @else {
                N/A
                }
              </td>

              <td>
                @if (element.enabled) {
                <p-tag severity="success" value="Activé"></p-tag>

                } @else {
                <p-tag severity="danger" value="Désactivé"></p-tag>

                }
              </td>
              <td>
                <span class="gna-action-span-div">
                  <span class="gna-action-span">
                    @if (element.enabled) {
                    <img src="assets/svg/active.svg" class="gna-table-btn-enable"
                      (click)="onConfirmToggleEnabled(element, true)">
                    } @else {
                    <img src="assets/svg/inactive.svg" class="gna-table-btn-enable"
                      (click)="onConfirmToggleEnabled(element, false)">
                    }
                  </span>

                  
                  <span class="gna-action-span">
                    <p-button 
                      icon="pi pi-eye" 
                      class="gna-btn-eye" 
                      pTooltip="Afficher" 
                      tooltipPosition="bottom"
                      [disabled]="isSave"
                      (click)="onView(element)"
                    ></p-button>

                  </span>
                  <span class="gna-action-span">
                    <p-button 
                      icon="pi pi-pencil" 
                      class="gna-btn-eye" 
                      pTooltip="Modifier" 
                      tooltipPosition="bottom"
                      [disabled]="isSave"
                      (click)="onViewEdit(element)"
                    ></p-button>

                  </span>
                  <span class="gna-action-span">
                    @if (element.removable) {
                      
                        <p-button 
                          icon="pi pi-trash" 
                          class="gna-btn-eye" 
                          pTooltip="Supprimer" 
                          tooltipPosition="bottom"
                          [disabled]="isSave"
                          (click)="onConfirm(element)"
                        ></p-button>

                      } @else {
                      <p-button 
                        icon="pi pi-trash" 
                        class="gna-btn-eye gna-disable" 
                        pTooltip="Supprimer" 
                        tooltipPosition="bottom"
                        [disabled]="isSave"
                        (click)="onConfirm(element)"
                      ></p-button>


                      }

                    

                  </span>
                  
                  
                 
                </span>
              </td>


            </tr>

          </ng-template>



          <ng-template pTemplate="loadingbody">
            <tr *ngFor="let item of fakeDataList">
              <td><p-skeleton width="8rem" styleClass="mb-4"></p-skeleton></td>
              <td><p-skeleton width="8rem" styleClass="mb-4"></p-skeleton></td>
              <td><p-skeleton width="8rem" styleClass="mb-4"></p-skeleton></td>
              <td><p-skeleton width="8rem" styleClass="mb-4"></p-skeleton></td>
              <td><p-skeleton width="8rem" styleClass="mb-4"></p-skeleton></td>
              <td><p-skeleton width="8rem" styleClass="mb-4"></p-skeleton></td>
              <td>
                <span class="gna-action-span-div">
                  <span class="gna-action-span">
                    <p-skeleton size="2rem" styleClass="mr-2" />
                  </span>
                </span>
              </td>
            </tr>
          </ng-template>

        </p-table>

      </div>
    </mat-card>

  </div>

  <div class="gna-pagination-row" *ngIf="filteredList.length > 5">

    <div class="gna-pagination">

      @if (dataPaginationResponse ) {
      @if (dataPaginationResponse.pageSize > 0) {
      <span class="gna-pagination-page-size" [matMenuTriggerFor]="aboveMenu"
        [ngClass]="{'gna-pagination-disabled': isSave}">{{ dataPaginationResponse.pageSize }}
        <i class="pi pi-angle-up"></i></span>
      <mat-menu #aboveMenu="matMenu" yPosition="above">
        @for (psl of pageSizeList; track psl) {
        <button mat-menu-item (click)="onGetPageSize(psl.name)" [disabled]="isSave">{{ psl.name }}</button>
        }
      </mat-menu>
      } @else {
      <span class="gna-pagination-page-size gna-pagination-disabled">0
        <i class="pi pi-angle-up"></i></span>
      }
      } @else {
      <span class="gna-pagination-page-size gna-pagination-disabled">0
        <i class="pi pi-angle-up"></i></span>
      }
    </div>

    <div class="gna-pagination">
      @if (dataPaginationResponse ) {
      @if (currentPage > 1) {
      <span class="gna-pagination-previous" (click)="onGoToPrevious()" [ngClass]="{'gna-pagination-disabled': isSave}">
        <i class="pi pi-arrow-left"></i>
      </span>
      } @else {
      <span class="gna-pagination-previous gna-pagination-disabled">
        <i class="pi pi-arrow-left"></i>
      </span>
      }
      @if (dataPaginationResponse.pageSize > 0) {
      <span class="gna-pagination-page" [ngClass]="{'gna-pagination-disabled': isSave}">{{ currentPage }}</span>
      } @else {
      <span class="gna-pagination-page gna-pagination-disabled">0</span>
      }
      @if (currentPage < dataPaginationResponse.totalPages) { <span class="gna-pagination-next" (click)="onGoToNext()"
        [ngClass]="{'gna-pagination-disabled': isSave}">
        <i class="pi pi-arrow-right"></i>
        </span>
        } @else {
        <span class="gna-pagination-next gna-pagination-disabled">
          <i class="pi pi-arrow-right"></i>
        </span>
        }
        } @else {
        <span class="gna-pagination-previous gna-pagination-disabled"><i class="pi pi-arrow-left"></i></span>
        <span class="gna-pagination-page gna-pagination-disabled">0</span>
        <span class="gna-pagination-next gna-pagination-disabled"><i class="pi pi-arrow-right"></i></span>
        }
    </div>

  </div>



</div>