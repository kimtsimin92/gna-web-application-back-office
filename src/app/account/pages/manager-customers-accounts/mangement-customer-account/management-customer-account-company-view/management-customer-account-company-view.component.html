<div class="gna-bc">
    <span>Gestion des comptes / Comptes / Entreprises</span>
  </div>

  <div class="container-fluid">

    <div>
      <mat-card class="gna-card">
        <mat-card-header class="gna-card-header">
          <div class="container-fluid">

            <div class="gna-card-header-btn row">
              <div class="col-12 col-sm-4 col-md-4 col-lg-4 col-xl-2">

                @if (isSave || accountService.pageLoading || accountService.isSave) {
                  <button mat-raised-button color="primary"
                          class="gna-full-width gna-btn-default gna-disable">Retour</button>
                } @else {
                  <button mat-raised-button color="primary"
                          class="gna-full-width gna-btn-default"
                          (click)="onGoToBack()"
                          [disabled]="isSave || accountService.pageLoading || accountService.isSave">Retour</button>
                }

              </div>

            </div>
          </div>
        </mat-card-header>

        <mat-card-content>

          <div class="container-fluid">
            <div class="example-table-container mt-4">
              <div class="card">
                <div class="card-body gna-card-body"
                     *ngIf="elementData">

                  <div class="row">
                    <div class="col-12 col-sm-6 col-md-6 col-lg-6 col-xl-6">
                      <span class="gna-view-label">Etat : </span>
                      @if (elementData.is_active) {
                        <p-tag severity="success" value="Activé"></p-tag>
                      } @else  {
                        <p-tag severity="danger" value="Désactivé"></p-tag>
                      }
                    </div>
                    <div class="col-12 col-sm-6 col-md-6 col-lg-6 col-xl-6">
                      <span class="gna-view-label">Enregistrement : </span>
                      @if (elementData.created_at) {
                        {{ elementData.created_at | date: 'dd-MM-YYYY'}} {{ elementData.created_at | date: 'hh:mm:ss'}}
                      } @else  {
                        N/A
                      }
                    </div>
                  </div>

                  <div class="row">

                    <div class="col-12 col-sm-6 col-md-6 col-lg-6 col-xl-6">
                      <span class="gna-view-label">Type Compte : </span>
                      <span class="gna-view-value">
                     Entreprise
                    </span>
                    </div>

                    <div class="col-12 col-sm-6 col-md-6 col-lg-6 col-xl-6">
                      <span class="gna-view-label"> Code Compte : </span>
                      <span class="gna-view-value">
                         @if (elementData.numero_compte ) {
                           {{ elementData.numero_compte }}
                         } @else {
                           N/A
                         }
                    </span>
                    </div>

                    <div class="col-12 col-sm-6 col-md-6 col-lg-6 col-xl-6">
                      <span class="gna-view-label"> Code Assuré : </span>
                      <span class="gna-view-value">
                         @if (elementData.numero_assure ) {
                           {{ elementData.numero_assure }}
                         } @else {
                           N/A
                         }
                    </span>
                    </div>


                    <div class="col-12 col-sm-6 col-md-6 col-lg-6 col-xl-6">
                      <span class="gna-view-label"> N° CNI : </span>
                      <span class="gna-view-value">
                         @if (elementData.matricule_cni ) {
                           {{ elementData.matricule_cni }}
                         } @else {
                           N/A
                         }
                    </span>
                    </div>

                    <div class="col-12 col-sm-6 col-md-6 col-lg-6 col-xl-6">
                      <span class="gna-view-label"> Raison Sociale : </span>
                      <span class="gna-view-value">
                         @if (elementData.raison_sociale ) {
                           {{ elementData.raison_sociale }}
                         } @else {
                           N/A
                         }
                    </span>
                    </div>

                    <div class="col-12 col-sm-6 col-md-6 col-lg-6 col-xl-6">
                      <span class="gna-view-label">Code Segment : </span>
                      <span class="gna-view-value">
                       @if (elementData.segment ) {
                         {{ elementData.segment.name }}
                       } @else {
                         N/A
                       }
                    </span>
                    </div>

                    <div class="col-12 col-sm-6 col-md-6 col-lg-6 col-xl-6">
                      <span class="gna-view-label"> Prénom : </span>
                      <span class="gna-view-value">
                         @if (elementData.prenom ) {
                           {{ elementData.prenom }}
                         } @else {
                           N/A
                         }
                    </span>
                    </div>

                    <div class="col-12 col-sm-6 col-md-6 col-lg-6 col-xl-6">
                      <span class="gna-view-label">Email : </span>
                      <span class="gna-view-value">
                      @if (elementData.email) {
                        {{ elementData.email }}
                      } @else {
                        N/A
                      }
                    </span>
                    </div>

                    <div class="col-12 col-sm-6 col-md-6 col-lg-6 col-xl-6">
                      <span class="gna-view-label">Téléphone : </span>
                      <span class="gna-view-value">
                        @if (elementData.contact ) {
                          {{ elementData.contact }}
                        } @else {
                          N/A
                        }
                    </span>
                    </div>

                    <div class="col-12 col-sm-6 col-md-6 col-lg-6 col-xl-6">
                      <span class="gna-view-label">Adresse : </span>
                      <span class="gna-view-value">
                      @if (elementData.adress) {
                        {{ elementData.adress }}
                      } @else {
                        N/A
                      }</span>
                    </div>

                  </div>

                </div>
              </div>

              <div class="row gna-files">
                <span class="gna-files-underline">Documents joints</span>
                <div class="row">

                  @if (elementData.medias && elementData.medias.length > 0) {

                    <div class="col-6 col-sm-6 col-md-2 col-lg-1 col-xl-1" *ngFor="let file of elementData.medias">
                      <span class="gna-element-file-name">{{ file.libelle }}</span>
                      <br>

                      @if (file.type == "image/jpeg" ) {
                        <a href="{{ environment.customersService+file.lien }}" download target="_blank">
                          <img src="assets/svg/files/jpg-svgrepo-com.svg" alt="{{ file.libelle }}" class="gna-element-file gna-clickable">
                        </a>
                      } @else if (file.type == "image/png") {
                        <a href="{{ environment.customersService+file.lien }}" download target="_blank">
                          <img src="assets/svg/files/png-svgrepo-com.svg" alt="{{ file.libelle }}" class="gna-element-file gna-clickable">
                        </a>
                      } @else if (file.type == "pdf") {
                        <a href="{{ environment.customersService+file.lien }}" download target="_blank">
                          <img src="assets/svg/files/pdf-svgrepo-com.svg" alt="{{ file.libelle }}" class="gna-element-file gna-clickable">
                        </a>
                      } @else if (file.type == "doc" || "doc") {
                        <a href="{{ environment.customersService+file.lien }}" download target="_blank">
                          <img src="assets/svg/files/word-svgrepo-com.svg" alt="{{ file.libelle }}" class="gna-element-file gna-clickable">
                        </a>
                      }

                    </div>

                  } @else {
                    <div class="col">
                      <span class="gna-element-file-name">N/A</span>
                    </div>
                  }

                </div>
              </div>

              <p-table #dt [value]="elementData.assures" dataKey="id" styleClass="p-datatable-striped"
                       [tableStyle]="{ 'min-width': '50rem' }"
                       [totalRecords]="elementData.assures.length"
                       [globalFilterFields]="['numero_assure', 'libelle']" [scrollable]="true"
                       [resizableColumns]="true"
                       [paginator]="true"
                       [rows]="5"
                       [rowsPerPageOptions]="[5, 10, 20, 50, 100]">
                <ng-template pTemplate="header">
                  <tr class="gna-table-header">
                    <th pSortableColumn="numero_assure">
                      Code Assuré
                      <p-sortIcon field="numero_assure" />
                      <!--                  <p-columnFilter type="text" field="matricule_cmu" display="menu" />-->
                    </th>
                    <th pSortableColumn="type_assure">
                      Type Assuré
                      <p-sortIcon field="type_assure" />
                      <!--                  <p-columnFilter type="text" field="matricule_cmu" display="menu" />-->
                    </th>
                    <th pSortableColumn="nom">Nom Assuré
                      <!--                  <p-columnFilter type="text" field="nom" display="menu" />-->
                      <p-sortIcon field="nom" />
                    </th>
                    <th pSortableColumn="libelle">Caractéristiques Assuré
                      <!--                  <p-columnFilter type="text" field="nom" display="menu" />-->
                      <p-sortIcon field="libelle" />
                    </th>

                    <th pSortableColumn="is_active">Etat
                      <!--                  <p-columnFilter type="date" field="created_at" display="menu" />-->
                      <p-sortIcon field="is_active" />
                    <th pSortableColumn="created_at" class="gna-responsive">Enregistrement
                      <!--                  <p-columnFilter type="date" field="created_at" display="menu" />-->
                      <p-sortIcon field="created_at" />
                  </tr>
                </ng-template>

                <ng-template pTemplate="body" let-element let-expanded="expanded">
                  <tr>
                    <td>
                      <div class="row">
                        <div class="col-4">
                          <p-button type="button" pRipple [pRowToggler]="element" [text]="true"
                                    [rounded]="true" [plain]="true"
                                    [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"
                                    (onClick)="onGetCustomerAccountFilesById(element)" />
                        </div>
                        <div class="col-8 gna-table-td-mt">
                          @if (element.numero_assure ) {
                            {{ element.numero_assure }}
                          } @else {
                            N/A
                          }
                        </div>
                      </div>
                    </td>
                    <td>
                      @if (element.type_assure) {
                        {{ element.type_assure.libelle }}
                      } @else {
                        N/A
                      }
                    </td>
                    <td>
                      @if (element.nom) {
                        {{ element.nom }} {{ element.prenom }}
                      } @else if (element.raison_sociale) {
                        {{ element.raison_sociale }}
                      } @else {
                        N/A
                      }
                    </td>
                    <td>
                      @if (element.libelle) {
                        {{ element.libelle }}
                      } @else {
                        N/A
                      }
                    </td>
                    <td>
                      @if (element.is_active) {
                        <p-tag severity="success" value="Activé"></p-tag>
                      } @else {
                        <p-tag severity="danger" value="Désactivé"></p-tag>
                      }
                    </td>
                    <td class="gna-responsive">
                      @if (element.created_at) {
                        {{ element.created_at | date: 'dd-MM-YYYY'}} {{ element.created_at | date:
                        'hh:mm:ss'}}
                      } @else {
                        N/A
                      }
                    </td>
                  </tr>

                </ng-template>

                <ng-template pTemplate="rowexpansion" let-element>
                  <div class="container">

                    <div class="gna-table-files">

                      <span class="gna-files-underline">Documents joints</span>
                      <div class="row gna-table-files-row">

                        @if (element.medias && element.medias.length > 0) {
                          <div class="col" *ngFor="let file of element.medias">
                            <span class="gna-element-file-name">{{ file.libelle }}</span>
                            <br>

                            @if (file.type == "image/jpeg" ) {
                              <a href="{{ environment.customersService+file.lien }}" download target="_blank">
                                <img src="assets/svg/files/jpg-svgrepo-com.svg" alt="{{ file.libelle }}" class="gna-element-file gna-clickable">
                              </a>
                            } @else if (file.type == "image/png") {
                              <a href="{{ environment.customersService+file.lien }}" download target="_blank">
                                <img src="assets/svg/files/png-svgrepo-com.svg" alt="{{ file.libelle }}" class="gna-element-file gna-clickable">
                              </a>
                            } @else if (file.type == "pdf") {
                              <a href="{{ environment.customersService+file.lien }}" download target="_blank">
                                <img src="assets/svg/files/pdf-svgrepo-com.svg" alt="{{ file.libelle }}" class="gna-element-file gna-clickable">
                              </a>
                            } @else if (file.type == "doc" || "doc") {
                              <a href="{{ environment.customersService+file.lien }}" download target="_blank">
                                <img src="assets/svg/files/word-svgrepo-com.svg" alt="{{ file.libelle }}" class="gna-element-file gna-clickable">
                              </a>
                            }

                          </div>
                        } @else {
                          <div class="col">
                            <span class="gna-element-file-name">N/A</span>
                          </div>
                        }

                      </div>
                    </div>


                  </div>

                </ng-template>

              </p-table>

            </div>

          </div>
        </mat-card-content>

      </mat-card>

    </div>

  </div>
